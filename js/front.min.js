String.prototype.toSlug=function(){return this.replace(/^\s+|\s+$/gm,"").replace(/[^a-z0-9-]/gi,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").toLowerCase()},BathHacked={Options:{themes:{dark:{title:"#333",value:"#333",label:"#666",gauge:"#ddd"},light:{title:"#fff",value:"#fff",label:"#888",gauge:"#fff"}},sectors:function(t){return[{color:"#d9392c",lo:0,hi:.25*t},{color:"#f5821f",lo:.25*t,hi:.5*t},{color:"#50a64a",lo:.5*t,hi:t}]},refreshInterval:12e4}},BathHacked.RadialGauge=function(t,a){this.$elt=t,this.gauge=null,this.init=function(){var t=this.$elt.data("max")-this.$elt.data("min"),e=BathHacked.Options.themes[this.$elt.data("theme")];this.gauge=new JustGage({id:this.$elt.attr("id"),min:this.$elt.data("min"),max:this.$elt.data("max"),value:this.$elt.data("value"),title:this.$elt.data("title"),gaugeColor:e.gauge,titleFontColor:e.title,valueFontColor:e.value,labelFontColor:e.label,label:this.$elt.data("label"),showInnerShadow:!0,shadowSize:3,shadowOpacity:.2,customSectors:BathHacked.Options.sectors(t),levelColorsGradient:!1,startAnimationTime:2e3,startAnimationType:"bounce",refreshAnimationTime:2e3,refreshAnimationType:"bounce"});a("<div data-ui-label></div>").insertAfter(this.$elt);this.refresh()},this.refresh=function(){var t=this.$elt.parent().find("[data-ui-label]"),a=this.$elt.data("percentage")+"% full at "+this.$elt.data("updated");a+='<br/><span class="status '+this.$elt.data("status").toLowerCase()+'">'+this.$elt.data("status")+"</span>",t.html(a),this.gauge.refresh(this.$elt.data("value"))},this.init()},BathHacked.LinearGauge=function(t,a){this.$elt=t,this.init=function(){var t=BathHacked.Options.themes[this.$elt.data("theme")];this.$elt.css("background-color",t.gauge);a("<p data-title></p>").insertBefore(this.$elt),a("<div data-bar></div>").appendTo(this.$elt),a("<p data-bounds></p>").insertAfter(this.$elt);this.refresh()},this.refresh=function(){var t=BathHacked.Options.themes[this.$elt.data("theme")],e=this.$elt.parent().find("[data-title]"),i='<h4 class="title">'+this.$elt.data("title")+"</h4>";i+=' <span class="available"><strong>'+this.$elt.data("value")+"</strong> Available</span>",i+=' / <span class="percentage"><strong>'+this.$elt.data("percentage")+"%</strong> full</span>",i+=' <span class="updated">at <strong>'+this.$elt.data("updated")+"</strong></span>",e.html(i),e.css("color",t.label),e.find(".title").css("color",t.title);var s=this.$elt.find("[data-bar]"),l=this.$elt.data("max")-this.$elt.data("min"),n=this.$elt.data("value"),r=l>0?100*(n-this.$elt.data("min"))/l:0;window.setTimeout(function(){s.css("width",r+"%")},200),a.each(BathHacked.Options.sectors(l),function(t,a){n>=a.lo&&n<a.hi&&s.css("background-color",a.color)});var h=this.$elt.parent().find("[data-bounds]"),d='<span class="min">'+this.$elt.data("min")+"</span>";d+='<span class="status '+this.$elt.data("status").toLowerCase()+'">'+this.$elt.data("status")+"</span>",d+='<span class="max">'+this.$elt.data("max")+"</span>",h.html(d),h.css("color",t.label)},this.init()},BathHacked.CarParks=function(t,a,e,i,s,l){var n=this;this.$elt=a,this.url=e,this.style=s||"radial",this.theme=l||"dark",this.values=[],this.index=i,this.init=function(){this.refresh(),setInterval(this.refresh,BathHacked.Options.refreshInterval)},this.refresh=function(){t.ajax(e).done(function(t){n.setValues(t),n.repaint()})},this.setValues=function(a){this.values=[],t.each(a,function(t,a){a.occupancy=parseInt(a.occupancy),a.capacity=parseInt(a.capacity),a.percentage=parseInt(a.percentage),a.occupancy>a.capacity&&(a.occupancy=a.capacity),a.percentage>100&&(a.percentage=100),a.available=a.capacity-a.occupancy,a.updated=moment(this.lastupdate).format("HH:mm"),n.values.push(a)}),n.values.sort(function(t,a){return t.available<a.available?1:t.available>a.available?-1:0})},this.repaint=function(){t.each(this.values,function(){var a=this.name.toSlug()+"_"+n.index,e=n.$elt.find("[data-gauge]#"+a);0==e.length&&(e=t('<div id="'+a+'" data-gauge="'+n.style+'"><div  id="ui_'+a+'" data-ui-container></div></div>').appendTo(n.$elt));var i=e.find("[data-ui-container]");if(i.data("min",0),i.data("max",this.capacity),i.data("value",this.available),i.data("title",this.name),i.data("label","AVAILABLE"),i.data("theme",n.theme),i.data("percentage",this.percentage),i.data("status",this.status),i.data("updated",this.updated),"radial"==n.style&&"undefined"==typeof i.data("gauge"))i.data("gauge",new BathHacked.RadialGauge(i,t));else if("linear"==n.style&&"undefined"==typeof i.data("gauge"))i.data("gauge",new BathHacked.LinearGauge(i,t));else{var s=i.data("gauge");s.refresh()}})},this.init()},function(t){t(function(){t("[data-car-parks][data-url]").each(function(a){{var e=t(this);new BathHacked.CarParks(t,e,e.data("url"),a,e.data("style"),e.data("theme"))}e.after('<p class="bath-hacked-credit">Built by <a href="https://twitter.com/@azazell0" target="_blank">@azazell0</a> / Powered by <a href="http://bathhacked.org" target="_blank">Bath: Hacked</a> / Data supplied by <a href="http://www.bathnes.gov.uk" target="_blank">BANES Council</a> for information purposes only</p>')})})}(jQuery);